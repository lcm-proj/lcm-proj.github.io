<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>LCM: Java Tutorial</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">LCM
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Home</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Java Tutorial </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Sending and receiving LCM messages with Java</p>
<h1><a class="anchor" id="tut_java_intro"></a>
Introduction</h1>
<p>This tutorial will show you how to use all of the core functionality of LCM, and is intended for those who have a working knowledge of Java. For detailed information about LCM, please see the <a href="javadocs/index.html">Java API reference</a>.</p>
<p>The topics covered in this tutorial are:</p>
<ul>
<li>Initialize LCM in your application. </li>
<li>Publish a message. </li>
<li>Subscribe to and receive a message.</li>
</ul>
<p>This tutorial uses the <code>example_t</code> message type defined in the <a class="el" href="tut_lcmgen.html">type definition tutorial</a>, and assumes that you have generated the Java bindings for the example type by running </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;lcm-gen -j example_t.lcm</div>
</div><!-- fragment --><p>After running this command, you should have one file, <code>exlcm/example_t.java</code>. This file is the Java binding for the example message type. If you have the time, take a moment to open up the file and inspect the generated code.</p>
<p>You can then compile this into a .class file, and then create a .jar archive. Assuming that <code>lcm.jar</code> is in the current directory (see the <a class="el" href="java_notes.html">Java notes</a> page), you could then run (also from a command shell):</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;javac -cp lcm.jar exlcm/*.java</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;jar cf my_types.jar exlcm/*.class</div>
</div><!-- fragment --><p>You should then have a file <code>my_types.jar</code>, which is a Java archive containing the Java bindings for the example message. In order to use LCM types, you must include the jar file on your classpath.</p>
<h1><a class="anchor" id="tut_java_initialize"></a>
Initializing LCM</h1>
<p>You will need to make sure that <em>lcm.jar</em> is in your classpath, and your Java classes will need to include "import lcm.lcm.*".</p>
<p>To initialize LCM, with default options, simply call:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;LCM myLCM = LCM.getSingleton();</div>
</div><!-- fragment --><p>The default options are suitable for communicating with other LCM applications on the local computer. For communication across computers, or other usages such as reading data from an LCM logfile (e.g., to post-process or analyze previously collected data), see the <a href="javadocs/index.html">Java API reference</a>.</p>
<h1><a class="anchor" id="tut_java_publish"></a>
Publishing a message</h1>
<p>We can instantiate and then publish some sample data as follows:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;import java.io.*;</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;import lcm.lcm.*;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;public class SendMessage</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;{</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    public static void main(String args[])</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    {</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;        try {</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;            LCM lcm = LCM.getSingleton();</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;            exlcm.example_t msg = new exlcm.example_t();</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;            msg.timestamp = System.nanoTime();</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;            msg.position = new double[] { 1, 2, 3 };</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;            msg.orientation = new double[] { 1, 0, 0, 0 };</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;            msg.ranges = new short[] {</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;                0, 1, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;            };</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;            msg.num_ranges = msg.ranges.length;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;            msg.name = &quot;example string&quot;;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;            msg.enabled = true;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;            lcm.publish(&quot;EXAMPLE&quot;, msg);</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;        } catch (IOException ex) {</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;            System.out.println(&quot;Exception: &quot; + ex);</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;        }</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    }</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;}</div>
</div><!-- fragment --><p>After initializing LCM, this application creates an instance of the example message, fills in some message fields, and then publishes the message.</p>
<p>The call to <code>lcm.publish()</code> serializes the data into a byte stream and transmits the packet using LCM to any interested receivers. The string <code>"EXAMPLE"</code> is the <em>channel</em> name, which is a string transmitted with each packet that identifies the contents to receivers. Receivers subscribe to different channels using this identifier, allowing uninteresting data to be discarded quickly and efficiently.</p>
<h1><a class="anchor" id="tut_java_subscribe"></a>
Subscribing to messages</h1>
<p>In order to receive messages, you must implement an <a href="javadocs/lcm/lcm/LCMSubscriber.html">LCMSubscriber</a> and pass it to <a href="javadocs/lcm/lcm/LCM.html#subscribe%28java.lang.String, lcm.lcm.LCMSubscriber%29">LCM.subscribe()</a>. The subscriber will be provided with a LCMDataInputStream that can be read for the message contents. All LCM data types include a constructor that takes a DataInput (including instances of LCMDataInputStream) as an argument. First, let's look at the subscriber:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;public class MySubscriber implements LCMSubscriber</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;{</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    public void messageReceived(LCM lcm, String channel, LCMDataInputStream ins)</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    {</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;        System.out.println(&quot;Received message on channel &quot; + channel);</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;        example_t msg;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;        try {</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;            msg = new example_t(ins);</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;        } catch (IOException ex) {</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;            System.out.println(&quot;Error decoding message: &quot; + ex);</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;            return;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;        }</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;        System.out.println(&quot;  timestamp    = &quot; + msg.timestamp);</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;        // Could do something else with the message here.</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;    }</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;}</div>
</div><!-- fragment --><p>Next, we can subscribe to the message with:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;lcm.subscriber(&quot;EXAMPLE&quot;, new MySubscriber());</div>
</div><!-- fragment --><p>The LCM instance has a background thread that constantly listens for messages. When a message on channel <code>"EXAMPLE"</code> arrives, the LCM thread will invoke the <a href="javadocs/lcm/lcm/LCMSubscriber.html#messageReceived%28lcm.lcm.LCM, java.lang.String, lcm.lcm.LCMDataInputStream%29">messageReceived()</a> method.</p>
<h2><a class="anchor" id="tut_java_together"></a>
Putting it all together</h2>
<p>Here's an example of a complete subscriber application:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;import java.io.*;</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;import lcm.lcm.*;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;import exlcm.*;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;public class MySubscriber implements LCMSubscriber</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;{</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    LCM lcm;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    public MySubscriber()</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;        throws IOException</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    {</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;        this.lcm = new LCM();</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;        this.lcm.subscribe(&quot;EXAMPLE&quot;, this);</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;    }</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    public void messageReceived(LCM lcm, String channel, LCMDataInputStream ins)</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;    {</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;        System.out.println(&quot;Received message on channel &quot; + channel);</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;        try {</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;            if (channel.equals(&quot;EXAMPLE&quot;)) {</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;                example_t msg = new example_t(ins);</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;                System.out.println(&quot;  timestamp    = &quot; + msg.timestamp);</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;                System.out.println(&quot;  position     = [ &quot; + msg.position[0] +</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;                                   &quot;, &quot; + msg.position[1] + &quot;, &quot; + msg.position[2] + &quot; ]&quot;);</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;                System.out.println(&quot;  orientation  = [ &quot; + msg.orientation[0] +</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;                                   &quot;, &quot; + msg.orientation[1] +</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;                                   &quot;, &quot; + msg.orientation[2] +</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;                                   &quot;, &quot; + msg.orientation[3] + &quot; ]&quot;);</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;                System.out.print(&quot;  ranges       = [ &quot;);</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;                for (int i=0; i&lt;msg.num_ranges; i++) {</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;                    System.out.print(&quot;&quot; + msg.ranges[i]);</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;                    if (i &lt; msg.num_ranges-1)</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;                        System.out.print (&quot;, &quot;);</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;                }</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;                System.out.println (&quot; ]&quot;);</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;                System.out.println(&quot;  name         = &#39;&quot; + msg.name + &quot;&#39;&quot;);</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;                System.out.println(&quot;  enabled      = &#39;&quot; + msg.enabled + &quot;&#39;&quot;);</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;            }</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;        } catch (IOException ex) {</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;            System.out.println(&quot;Exception: &quot; + ex);</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;        }</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    }</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    public static void main(String args[])</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    {</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;        try {</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;            MySubscriber m = new MySubscriber();</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;            while(true) {</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;                Thread.sleep(1000);</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;            }</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;        } catch (IOException ex) {</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;            System.out.println(&quot;Exception: &quot; + ex);</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        } catch (InterruptedException ex) { }</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    }</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;}</div>
</div><!-- fragment --><p>The full example is included in the LCM source distribution, in the <code>examples/java</code> directory.</p>
<h1><a class="anchor" id="tut_java_compiling_running"></a>
Compiling and running</h1>
<p>To compile and run the examples, let's assume that the <code>lcm.jar</code> file is in the current directory, along with <code>SendMessage.java</code>, <code>MySubscriber.java</code>, and <code>example_t.lcm</code>. We can run our programs by executing the commands:</p>
<pre class="fragment"># 1. Create the Java implementation of temperature_t.lcm
lcm-gen -j example_t.lcm

# 2. Compile the demo applications and the LCM type created above.
javac -cp .:lcm.jar *.java exlcm/*.java

# 3. Run MySubscriber (in one terminal)
java -cp .:lcm.jar MySubscriber 

# 4. Run SendMessage (in another terminal)
java -cp .:lcm.jar SendMessage 
</pre><h1><a class="anchor" id="tut_java_notes"></a>
Additional notes</h1>
<p>See the <a class="el" href="java_notes.html">Java notes</a> page for some additional information related to LCM development with Java. </p>
</div></div><!-- contents -->
<hr class="footer"/></body>
</html>
