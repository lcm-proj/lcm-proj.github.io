<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>LCM: MATLAB Tutorial</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">LCM
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Home</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">MATLAB Tutorial </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Sending and receiving LCM messages with MATLAB</p>
<h1><a class="anchor" id="tut_matlab_intro"></a>
Introduction</h1>
<p>This tutorial will walk you through the main tasks for exchanging LCM messages using the MATLAB API. The topics covered in this tutorial are:</p>
<ul>
<li>Setting up MATLAB to use LCM </li>
<li>Initialize LCM in your application. </li>
<li>Publish a message. </li>
<li>Subscribe to and receive a message.</li>
</ul>
<p>Using LCM with MATLAB is almost identical to using LCM through Java, since the MATLAB API relies on the LCM Java bindings. However, there are some differences, which mainly consist of how incoming messages are handled.</p>
<h1><a class="anchor" id="tut_matlab_setup"></a>
Setting up MATLAB to use LCM</h1>
<p>This tutorial uses the <code>example_t</code> message type defined in the <a class="el" href="tut_lcmgen.html">type definition tutorial</a>, and assumes that you have compiled <code>lcm.jar</code> (see the <a class="el" href="java_notes.html">Java notes</a> page), and generated the Java bindings for the example type by running the following (from a command shell, not the MATLAB prompt): </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;lcm-gen -j example_t.lcm</div>
</div><!-- fragment --><p>After running this command, you should have a file named <code>exlcm/example_t.java</code>. You can then compile this into a .class file, and then create a .jar archive. Assuming that <code>lcm.jar</code> is in the current directory, you could then run (also from a command shell):</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;javac -cp lcm.jar exlcm/*.java</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;jar cf my_types.jar exlcm/*.class</div>
</div><!-- fragment --><p>You should then have a file <code>my_types.jar</code>, which is a Java archive containing the Java bindings for the example message.</p>
<dl class="section note"><dt>Note</dt><dd>on Windows, use '\' instead of '/' for directory separators.</dd></dl>
<p>The next task is to tell MATLAB how to find LCM and the message bindings. You will first need to add <code>lcm.jar</code> and <code>my_types.jar</code> into the MATLAB classpath. You can do this from the MATLAB prompt or a MATLAB script by running:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;javaaddpath lcm.jar</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;javaaddpath my_types.jar</div>
</div><!-- fragment --><p>Once this is all setup, you can start using LCM from your MATLAB scripts.</p>
<h1><a class="anchor" id="tut_matlab_initialize"></a>
Initializing LCM</h1>
<p>You can initialize LCM from MATLAB as follows:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;lc = lcm.lcm.LCM.getSingleton();</div>
</div><!-- fragment --><p>The <code>lc</code> object now contains the communications context and interface for LCM. Since we're simply calling into the Java API here, see the <a href="javadocs/index.html">Java API documentation</a> for other ways on setting up LCM.</p>
<h1><a class="anchor" id="tut_matlab_publishing"></a>
Publishing a message</h1>
<p>We can instantiate and publish some sample data as follows:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;lc = lcm.lcm.LCM.getSingleton();</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;msg = exlcm.example_t();</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;msg.timestamp = 0;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;msg.position = [1  2  3];</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;msg.orientation = [1 0 0 0];</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;msg.ranges = 1:15;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;msg.num_ranges = length(msg.ranges);</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;msg.name = &#39;example string&#39;;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;msg.enabled = 1;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;lc.publish(&#39;EXAMPLE&#39;, msg);</div>
</div><!-- fragment --><p>For the most part, this example should be pretty straightforward. The application initializes LCM, creates a message, fills in the message data fields, then publishes the message using <code>lc.publish()</code>.</p>
<p>The call to <code>lc.publish</code> serializes the data into a byte stream and transmits the packet to any interested receivers. The string <code>'EXAMPLE'</code> is the <em>channel</em> name, which is a string transmitted with each packet that identifies the contents to receivers. Receivers subscribe to different channels using this identifier, allowing uninteresting data to be discarded quickly and efficiently.</p>
<p>The full example is available in runnable form in the <code>examples/matlab</code> directory in the LCM source distribution.</p>
<h1><a class="anchor" id="tut_matlab_receive"></a>
Receiving LCM Messages</h1>
<p>As discussed above, each LCM message is transmitted with an attached channel name. You can use these channel names to determine which LCM messages your application receives, by subscribing to the channels of interest. It is important for senders and receivers to agree on the channel names which will be used for each message type.</p>
<p>Here is a sample program that sets up LCM and adds a subscription to the <code>'EXAMPLE'</code> channel. Whenever a message is received on this channel, its contents are printed out. If messages on other channels are being transmitted over the network, this program will not see them because it only has a subscription to the <code>'EXAMPLE'</code> channel. A particular instance of LCM may have an unlimited number of subscriptions.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;lc = lcm.lcm.LCM.getSingleton();</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;aggregator = lcm.lcm.MessageAggregator();</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;lc.subscribe(&#39;EXAMPLE&#39;, aggregator);</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;while true</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    disp waiting</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    millis_to_wait = 1000;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    msg = aggregator.getNextMessage(millis_to_wait);</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    if length(msg) &gt; 0</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;        break</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    end</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;end</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;disp(sprintf(&#39;channel of received message: %s&#39;, char(msg.channel)))</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;disp(sprintf(&#39;raw bytes of received message:&#39;))</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;disp(sprintf(&#39;%d &#39;, msg.data&#39;))</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;m = exlcm.example_t(msg.data);</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;disp(sprintf(&#39;decoded message:\n&#39;))</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;disp([ &#39;timestamp:   &#39; sprintf(&#39;%d &#39;, m.timestamp) ])</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;disp([ &#39;position:    &#39; sprintf(&#39;%f &#39;, m.position) ])</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;disp([ &#39;orientation: &#39; sprintf(&#39;%f &#39;, m.orientation) ])</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;disp([ &#39;ranges:      &#39; sprintf(&#39;%f &#39;, m.ranges) ])</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;disp([ &#39;name:        &#39; m.name) ])</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;disp([ &#39;enabled:     &#39; sprintf(&#39;%d &#39;, m.enabled) ])</div>
</div><!-- fragment --><p>After initializing the LCM object, the application creates a <a href="javadocs/lcm/lcm/MessageAggregator.html">MessageAggregator</a> and subscribes it to the <code>'EXAMPLE'</code> channel. The sole purpose of the message aggregator is to receive messages on that channel and queue them up for later handling. This is different from how messages would normally be handled in Java, as MATLAB is not well suited to callback functions or multiple threads.</p>
<p>The example application then repeatedly calls <a href="javadocs/lcm/lcm/MessageAggregator.html#getNextMessage%28%29">MessageAggregator.getNextMessage()</a> which simply waits for a message of interest to arrive and then returns the raw data.</p>
<p>Once a message has arrived, the application decodes it by passing <code>msg.data</code> to the constructor for the example message type, and displays some message fields.</p>
<p>For more information on how to use the <a href="javadocs/lcm/lcm/MessageAggregator.html">MessageAggregator</a>, see the API documentation. This includes configuring messsaging limits such as a maximum number of messages to queue up to avoid falling behind real-time.</p>
<p>The full example is available in runnable form in the <code>examples/matlab</code> directory in the LCM source distribution. </p>
</div></div><!-- contents -->
<hr class="footer"/></body>
</html>
